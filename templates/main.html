<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>ğŸ‰ SOME BEAT</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="card">
    <h2>ğŸ‰ SOME BEAT</h2>
    <p>--------------------------------------</p>
    <p>ğŸ’¡ ì¸ ë³´ë‚´ê¸° = 1ë¹„íŠ¸ ì‚¬ìš©</p>
    <p>ğŸ’¡ ëˆ„ê°€ ë³´ëƒˆëŠ”ì§€ í™•ì¸ = 2ë¹„íŠ¸ ì‚¬ìš©</p>
    <p>ğŸ’¡ ì²˜ìŒ ì…ì¥ ì‹œ 1ë¹„íŠ¸ ì§€ê¸‰</p>
    <p>ğŸ’¡ ì‰¬ëŠ” ì‹œê°„ë§ˆë‹¤ í˜¸ìŠ¤íŠ¸ê°€ ë¹„íŠ¸ë¥¼ ì„ ë¬¼í•©ë‹ˆë‹¤!</p>
    <p>--------------------------------------</p>

    <p>ë‹‰ë„¤ì„: {{ user['nickname'] }} | ë‚´ ë¹„íŠ¸: {{ user['bit'] }} | ë°›ì€ ì¸: {{ received_count if received_count > 0 else 'ì—†ìŒ' }}</p>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div style="color:#FF4D6D; font-weight:bold; margin-bottom:10px;">
            {% for msg in messages %}
                <p>{{ msg }}</p>
            {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    {% if user['received_som'] and not user['checked_som_once'] %}
        <div style="color:#fbff00; font-weight:bold; margin-bottom:10px;">
        <p>ëˆ„êµ°ê°€ê°€ ë‚˜ì—ê²Œ ì¸ì„ ë³´ëƒˆì–´ìš” ğŸ’•</p>
    {% endif %}
    {% if user['new_received_som'] %}
        <div style="color:#fbff00; font-weight:bold; margin-bottom:10px;">
        <p>ìƒˆë¡œ ë°›ì€ ì¸ì´ ìˆì–´ìš” ğŸ’•</p>
    {% endif %}

    <!-- ê²€ìƒ‰ í¼ -->
    <form method="POST">
        <input type="text" name="search_nick" placeholder="ë‹‰ë„¤ì„ ê²€ìƒ‰" style="width:280px;">
        <button type="submit" style="width:70px;">ê²€ìƒ‰</button>
    </form>

    <!-- ê²€ìƒ‰ ê²°ê³¼ ì˜ì—­ -->
    <div id="search_result_area">
        {% if search_result is not none %}
            {% if search_result %}
                <div style="display:flex; align-items:center;">
                    <p style="margin:0;">
                         ğŸ’˜ {{ search_result['nickname'] }} ({{ search_result['gender'] }})
                    </p>

                    <form method="POST" style="margin-left:auto;">
                        <button type="submit"
                                name="send_som"
                                value="{{ search_result['nickname'] }}"
                                style="background-color:#0c638b; color:#ffffff;">
                            ğŸ’Œ ì¸ ë³´ë‚´ê¸° (1 ë¹„íŠ¸)
                        </button>
                    </form>
                </div>
            {% else %}
                <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
        {% endif %}
    </div>





    <!-- ë°›ì€ ì¸ í‘œì‹œ -->
    <div style="
        background-color:#494949;
        padding:12px;
        border-radius:10px;
        margin:12px 0;
    ">
        {% if received_som_list %}
            <ul>
                {% for s in received_som_list %}
                    <li>ë‚˜ì—ê²Œ ì¸ì„ ë³´ë‚¸ ì‚¬ëŒì€ '{{ s }}' ğŸ’•</li>
                {% endfor %}
            </ul>
        {% else %}
            <p style="margin:0; color:#ffffff;">ì•„ì§ ê³µê°œëœ ì¸ì´ ì—†ì–´ìš”</p>
        {% endif %}
        
        
    </div>
 
    {% if total_som == 0 %}
        <button type="button" disabled style="opacity:0.5;">
            ë°›ì€ ì¸ ì—†ìŒ
        </button>

    {% elif user.new_received_som and not user.checked_som_once %}
        <form method="POST">
            <button type="submit" name="check_som">
                ë°›ì€ ì¸ í™•ì¸í•˜ê¸° (2 ë¹„íŠ¸)
            </button>
        </form>

    {% elif user.new_received_som and user.checked_som_once %}
        <form method="POST">
            <button type="submit" name="check_som">
                ì¶”ê°€ë¡œ ë°›ì€ ì¸ í™•ì¸í•˜ê¸° (0 ë¹„íŠ¸)
            </button>
        </form>

    {% else %}
        <button type="button" disabled style="opacity:0.5;">
            âœ” ë°›ì€ ì¸ ëª¨ë‘ í™•ì¸í•¨
        </button>
    {% endif %}


   


    <form action="{{ url_for('order') }}">
        <button>ì£¼ë¬¸í•˜ê¸° & ì£¼ë¬¸ë‚´ì—­</button>
    </form>

    {% if is_host %}
    <form method="POST">
        <button type="submit" name="give_bit">í˜¸ìŠ¤íŠ¸ê°€ ë¹„íŠ¸ë¥¼ ì„ ë¬¼í•´ë“œë ¤ìš”</button>
    </form>
    {% endif %}

    <form action="{{ url_for('logout') }}">
        <button>ë¡œê·¸ì•„ì›ƒ</button>
    </form>

</div>
</body>
</html>
